import subprocess
import re

# Input file name
input_file = "ip_list.txt"

# Output file name
output_file = "webserver_versions.txt"

# Open the input file for reading
with open(input_file, "r") as f:
    # Read the IP addresses from the file into a list
    ip_list = [line.strip() for line in f]

# Open the output file for writing
with open(output_file, "w") as f:
    # Loop over the IP addresses in the list
    for ip in ip_list:
        # Run the ping command to check if the target is live
        result = subprocess.run(["ping", "-c", "1", "-w", "1", ip], capture_output=True, text=True)
        # If the target is live
        if "1 received" in result.stdout:
            # Run the curl command to get the server version
            result = subprocess.run(["curl", "-I", ip], capture_output=True, text=True)
            # Parse the server version from the response headers using regex
            match = re.search(r"Server: (.+)", result.stdout)
            # If the server version was found
            if match:
                server_version = match.group(1)
                # Write the hostname and server version to the output file
                result = subprocess.run(["nslookup", ip], capture_output=True, text=True)
                hostname = re.search(r"Name: (.+)", result.stdout).group(1)
                f.write(f"{hostname} : {server_version}\n")
