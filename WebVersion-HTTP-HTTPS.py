import socket
import requests

# Define the input and output filenames
input_filename = "ip_addresses.txt"
output_filename = "output.txt"

# Read the list of IP addresses from the input file
with open(input_filename, "r") as f:
    ip_addresses = f.read().splitlines()

# Open the output file for writing
with open(output_filename, "w") as f:
    # Iterate over each IP address
    for ip_address in ip_addresses:
        try:
            # Try to resolve the IP address to a hostname
            hostname = socket.gethostbyaddr(ip_address)[0]
        except socket.herror:
            # Handle error if IP address cannot be resolved to a hostname
            hostname = "N/A"
        
        # Check if the IP address has port 80 or port 443 open
        try:
            response = requests.get(f"http://{ip_address}/", timeout=5)
            webserver_version = response.headers.get("server", "N/A")
        except requests.exceptions.Timeout:
            # Handle error if connection times out
            webserver_version = "Connection timed out"
        except requests.exceptions.ConnectionError:
            # Handle error if connection is refused or reset
            webserver_version = "Connection refused/reset"
        except:
            # Handle any other error
            webserver_version = "N/A"
            
        try:
            response = requests.get(f"https://{ip_address}/", timeout=5)
            webserver_version = response.headers.get("server", "N/A")
        except requests.exceptions.Timeout:
            # Handle error if connection times out
            webserver_version = "Connection timed out"
        except requests.exceptions.ConnectionError:
            # Handle error if connection is refused or reset
            webserver_version = "Connection refused/reset"
        except:
            # Handle any other error
            pass
        
        # Try to resolve the name servers for the hostname
        try:
            name_servers = ", ".join(socket.gethostbyname_ex(hostname)[2])
        except socket.gaierror:
            # Handle error if name servers cannot be resolved
            name_servers = "N/A"
        
        # Write the IP address, hostname, name servers, and webserver version to the output file
        f.write(f"{ip_address} {hostname} {name_servers} {webserver_version}\n")
