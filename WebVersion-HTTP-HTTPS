import socket
import requests

# Define the input and output filenames
input_filename = "ip_addresses.txt"
output_filename = "output.txt"

# Read the list of IP addresses from the input file
with open(input_filename, "r") as f:
    ip_addresses = f.read().splitlines()

# Open the output file for writing
with open(output_filename, "w") as f:
    # Iterate over each IP address
    for ip_address in ip_addresses:
        # Try to resolve the IP address to a hostname
        try:
            hostname = socket.gethostbyaddr(ip_address)[0]
        except socket.herror:
            hostname = "N/A"
        
        # Check if the IP address has port 80 or port 443 open
        try:
            response = requests.get(f"http://{ip_address}/", timeout=5)
            webserver_version = response.headers.get("server", "N/A")
        except:
            webserver_version = "N/A"
            
        try:
            response = requests.get(f"https://{ip_address}/", timeout=5)
            webserver_version = response.headers.get("server", "N/A")
        except:
            pass
        
        # Try to resolve the name servers for the hostname
        try:
            name_servers = ", ".join(socket.gethostbyname_ex(hostname)[2])
        except:
            name_servers = "N/A"
        
        # Write the IP address, hostname, name servers, and webserver version to the output file
        f.write(f"{ip_address} {hostname} {name_servers} {webserver_version}\n")
